name: éªŒè¯GitHub Tokenå¹¶åˆ›å»ºGist

on:
    workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘æµ‹è¯•

jobs:
    test-token:
      runs-on: ubuntu-latest

      steps:
      - name: éªŒè¯GitHub Token
        run: |
          echo "æ­£åœ¨éªŒè¯GitHub Token..."

          # éªŒè¯TokenåŸºæœ¬æƒé™
          user_info=$(curl -s \
            -H "Authorization: Bearer ${{ secrets.PUSH_TOKEN }}" \
            -H "Accept: application/vnd.github+json" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            "https://api.github.com/user")

          if echo "$user_info" | grep -q '"login"'; then
            echo "âœ… TokenéªŒè¯æˆåŠŸ"
            username=$(echo "$user_info" | grep -o '"login":"[^"]*"' | sed 's/"login":"\(.*\)"/\1/')
            echo "ğŸ‘¤ ç”¨æˆ·å: $username"
          else
            echo "âŒ TokenéªŒè¯å¤±è´¥"
            echo "è¯·æ£€æŸ¥PUSH_TOKENæ˜¯å¦æœ‰æ•ˆä¸”å…·æœ‰é€‚å½“çš„æƒé™"
            exit 1
          fi

          # æ£€æŸ¥Gistæ˜¯å¦å­˜åœ¨
          echo "ğŸ” æ£€æŸ¥Gistæ˜¯å¦å­˜åœ¨..."
          gist_response=$(curl -s \
            -H "Authorization: Bearer ${{ secrets.PUSH_TOKEN }}" \
            -H "Accept: application/vnd.github+json" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            "https://api.github.com/gists/${{ secrets.GIST_ID }}")

          if echo "$gist_response" | grep -q '"id"'; then
            echo "âœ… Gistå­˜åœ¨ä¸”å¯è®¿é—®"
            echo "ğŸ“‹ Gistæè¿°: $(echo "$gist_response" | grep -o '"description":"[^"]*"' | sed 's/"description":"\(.*\)"/\1/')"
            echo "ğŸ“ Gistæ–‡ä»¶:"
            echo "$gist_response" | grep -o '"filename":"[^"]*"' | sed 's/"filename":"\(.*\)"/  - \1/'
          else
            echo "âš ï¸  Gistä¸å­˜åœ¨æˆ–æ— æƒè®¿é—®"
            fi
          fi
